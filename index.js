(()=>{"use strict";class t{constructor(t){this.player=t,this.keys={},document.addEventListener("keydown",(t=>this.onKeyDown(t))),document.addEventListener("keyup",(t=>this.onKeyUp(t)))}onKeyDown(t){this.keys[t.code]=!0}onKeyUp(t){this.keys[t.code]=!1}keyIsPressed(t){return this.keys[t]||!1}update(t){this.keyIsPressed("KeyW")&&this.player.moveForward(t),this.keyIsPressed("KeyS")&&this.player.moveBackward(t),this.keyIsPressed("KeyA")&&this.player.turnLeft(t),this.keyIsPressed("KeyD")&&this.player.turnRight(t)}}const s={WINDOW_WIDTH:1024,WINDOW_HEIGHT:768,TILE_SIZE:16,FOV:.5,VIEW_DISTANCE:100,WALL_HEIGHT:16,COLUMN_WIDTH:1};class e{constructor(t){this.grid=t}render(t){const e=s.TILE_SIZE/4;for(let s=0;s<this.grid.length;s++)for(let i=0;i<this.grid[s].length;i++){const r=this.grid[s][i];7===r?t.drawRect(i*e,s*e,e,e,"white"):2===r&&t.drawRect(i*e,s*e,e,e,"blue")}}getCell(t,s){return t=Math.floor(t),s=Math.floor(s),!(t<0||t>=this.grid[0].length||s<0||s>=this.grid.length)&&this.grid[s][t]}}class i{constructor(t,s){this._x=t,this._y=s}get x(){return this._x}get y(){return this._y}set x(t){this._x=t}set y(t){this._y=t}}class r{constructor(t,s,e,i){this.position=t,this.angle=s,this.speed=e,this.fov=i}update(t){}render(t){const e=s.TILE_SIZE/4;t.drawRect(this.position.x*e,this.position.y*e,e,e,"red")}changeSpeed(t){this.speed=t}moveForward(t){this.position.x+=Math.cos(this.angle)*this.speed*t,this.position.y+=Math.sin(this.angle)*this.speed*t}moveBackward(t){this.position.x-=Math.cos(this.angle)*this.speed*t,this.position.y-=Math.sin(this.angle)*this.speed*t}turnLeft(t){this.angle-=this.speed/5*t}turnRight(t){this.angle+=this.speed/5*t}}class h{constructor(t,s,e,i,r){this.canvas=t,this.canvas.width=s,this.canvas.height=e,this.canvas.style.backgroundColor="gray",this.ctx=t.getContext("2d"),this.map=i,this.assets=r}clear(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}drawRect(t,s,e,i,r){this.ctx.fillStyle=r,this.ctx.fillRect(t,s,e,i)}castRay(t,e,i){let r=t,h=e,a=i,n=0,o=null;const c=s.VIEW_DISTANCE;let l=0,d=0;for(;n<c;){if(r=t+n*Math.cos(a),h=e+n*Math.sin(a),o=this.map.getCell(Math.floor(r),Math.floor(h)),0!==o){l=r%1,d=h%1;break}n+=.01}return{distance:n,object:o,xOffset:l,yOffset:d}}render(t){const e=this.canvas.width,i=t.position.x,r=t.position.y,h=t.angle;this.clear();for(let t=0;t<e;t+=s.COLUMN_WIDTH){const a=h-s.FOV/2+t/e*s.FOV,n=this.castRay(i,r,a);this.renderColumn(t,n)}}renderColumn(t,e){const i=this.canvas.height,r=e.distance,h=e.xOffset,a=(e.yOffset,s.TILE_SIZE/r*s.VIEW_DISTANCE),n=i/2-a/2,o=i/2+a/2,c=a*s.COLUMN_WIDTH*2,l=[16*e.object,0];this.drawRect(t,0,c,n,"skyblue"),this.drawRect(t,o,c,i-o,"green"),this.ctx.drawImage(this.assets["assets/textures.png"],l[0]+Math.floor(16*h),l[1],c,16,t,n,c,a)}}class a{constructor(){this.lastTime=performance.now(),this.deltaTime=0,this.callback=()=>{}}start(t){this.callback=t,this.lastTime=performance.now(),this.loop()}loop(){const t=performance.now();this.deltaTime=t-this.lastTime,this.lastTime=t,this.callback(this.deltaTime),requestAnimationFrame((()=>this.loop()))}getDeltaTime(){return this.deltaTime}}const n=new class{constructor(s){this.map=new e([[7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],[7,0,0,0,0,0,0,0,0,0,0,0,0,7,0,7,2,7],[7,0,0,0,0,0,0,0,0,0,0,0,0,0,2,7,0,7],[7,0,0,0,0,0,0,0,0,0,0,0,0,7,2,7,0,7],[7,0,0,0,0,0,0,0,0,0,0,0,0,7,2,7,0,7],[7,0,0,0,0,0,0,0,0,0,0,0,0,7,2,7,0,7],[7,0,0,0,0,0,0,0,0,0,0,0,0,7,2,7,0,7],[7,0,0,0,0,0,0,0,0,0,0,0,0,7,2,7,0,7],[7,7,7,7,7,7,7,7,7,7,7,7,7,7,2,7,0,7],[7,0,0,0,0,0,0,0,0,0,0,0,0,7,2,7,0,7],[7,0,0,0,0,0,0,0,0,0,0,7,7,7,2,7,0,7],[7,0,0,0,0,0,0,0,0,0,0,7,2,7,2,7,0,7],[7,0,0,0,0,0,0,0,0,0,0,7,2,7,2,7,0,7],[7,0,0,0,0,0,0,0,0,0,0,7,2,7,2,7,0,7],[7,0,0,0,0,0,0,0,0,0,0,7,2,7,2,7,0,7],[7,0,0,0,0,0,0,0,0,0,7,7,2,7,2,7,0,7],[7,0,0,0,0,0,0,0,0,0,7,2,2,7,2,7,0,7],[7,0,0,0,0,0,0,0,0,0,7,2,2,7,2,7,0,7],[7,0,0,0,0,0,0,0,0,0,7,2,2,7,2,7,0,7],[7,7,7,7,7,7,7,7,7,7,7,2,2,7,2,7,0,7],[7,2,2,2,2,2,2,2,2,2,7,2,2,7,2,7,0,7],[7,2,2,2,2,2,2,2,2,2,7,2,2,7,2,7,0,7],[7,2,2,2,2,2,2,2,2,2,7,2,2,7,2,7,0,7],[7,2,2,2,2,2,2,2,2,2,7,2,2,7,2,7,0,7]]),this.assets=function(t){const s={};return t.forEach((t=>{const e=new Image;e.src=t,s[t]=e})),s}(["assets/textures.png"]),this.timer=new a,this.renderer=new h(document.querySelector("canvas"),s.WINDOW_WIDTH,s.WINDOW_HEIGHT,this.map,this.assets),this.player=new r(new i(2,2),0,.005,s.FOV),this.controller=new t(this.player)}update(t){this.controller.update(t),this.player.update(t)}render(){this.renderer.clear(),this.renderer.render(this.player),this.map.render(this.renderer),this.player.render(this.renderer)}loop(t){this.update(t),this.render()}start(){this.timer.start((t=>this.loop(t)))}}(s);n.start()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxHQUNwRCxDQUFDLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxHQUNwRCxDQUFDLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxHQUNwRCxDQUFDLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxHQUNwRCxDQUFDLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxHQUNwRCxDQUFDLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxHQUNwRCxDQUFDLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxHQUNwRCxDQUFDLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxHQUNwRCxDQUFDLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxHQUNwRCxDQUFDLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxHQUNwRCxDQUFDLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxHQUNwRCxDQUFDLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxHQUNwRCxDQUFDLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxHQUNwRCxDQUFDLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxHQUNwRCxDQUFDLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxHQUNwRCxDQUFDLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxHQUNwRCxDQUFDLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxHQUNwRCxDQUFDLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxHQUNwRCxDQUFDLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxHQUNwRCxDQUFDLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxHQUNwRCxDQUFDLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxHQUNwRCxDQUFDLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxLQUV4RHRCLEtBQUtvRCxPQ25DTixTQUFvQitDLEdBQ3ZCLE1BQU0vQyxFQUFTLENBQUMsRUFNaEIsT0FMQStDLEVBQUlDLFNBQVNDLElBQ1QsTUFBTUMsRUFBTSxJQUFJQyxNQUNoQkQsRUFBSUgsSUFBTUUsRUFDVmpELEVBQU9pRCxHQUFRQyxDQUFHLElBRWZsRCxDQUNYLENEMkJzQm9ELENBQVcsQ0FBQyx3QkFDMUJ4RyxLQUFLeUcsTUFBUSxJQUFJbEIsRUFDakJ2RixLQUFLeUIsU0FBVyxJQUFJc0IsRUFBUzdDLFNBQVN3RyxjQUFjLFVBQVdSLEVBQU9uRixhQUFjbUYsRUFBT2xGLGNBQWVoQixLQUFLbUQsSUFBS25ELEtBQUtvRCxRQUN6SHBELEtBQUtELE9BQVMsSUFBSXVDLEVBQU8sSUFBSUgsRUFBUSxFQUFHLEdBQUksRUFBRyxLQUFPK0QsRUFBT2hGLEtBQzdEbEIsS0FBSzJHLFdBQWEsSUFBSTlHLEVBQVdHLEtBQUtELE9BQzFDLENBQ0FVLE9BQU9DLEdBQ0hWLEtBQUsyRyxXQUFXbEcsT0FBT0MsR0FDdkJWLEtBQUtELE9BQU9VLE9BQU9DLEVBQ3ZCLENBQ0FjLFNBQ0l4QixLQUFLeUIsU0FBU2dDLFFBQ2R6RCxLQUFLeUIsU0FBU0QsT0FBT3hCLEtBQUtELFFBQzFCQyxLQUFLbUQsSUFBSTNCLE9BQU94QixLQUFLeUIsVUFDckJ6QixLQUFLRCxPQUFPeUIsT0FBT3hCLEtBQUt5QixTQUM1QixDQUNBcUUsS0FBS3BGLEdBQ0RWLEtBQUtTLE9BQU9DLEdBQ1pWLEtBQUt3QixRQUNULENBQ0FxRSxRQUNJN0YsS0FBS3lHLE1BQU1aLE9BQU9uRixHQUFPVixLQUFLOEYsS0FBS3BGLElBQ3ZDLEdEdkRrQixHQUN0QnVGLEVBQUtKLE8iLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90c2JwLy4vc3JjL2NvbnRyb2xsZXIudHMiLCJ3ZWJwYWNrOi8vdHNicC8uL3NyYy9jb25maWcudHMiLCJ3ZWJwYWNrOi8vdHNicC8uL3NyYy9tYXAudHMiLCJ3ZWJwYWNrOi8vdHNicC8uL3NyYy9tYXRoLnRzIiwid2VicGFjazovL3RzYnAvLi9zcmMvcGxheWVyLnRzIiwid2VicGFjazovL3RzYnAvLi9zcmMvcmVuZGVyZXIudHMiLCJ3ZWJwYWNrOi8vdHNicC8uL3NyYy90aW1lci50cyIsIndlYnBhY2s6Ly90c2JwLy4vc3JjL2luZGV4LnRzIiwid2VicGFjazovL3RzYnAvLi9zcmMvZ2FtZS50cyIsIndlYnBhY2s6Ly90c2JwLy4vc3JjL3V0aWxzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBkZWZhdWx0IGNsYXNzIENvbnRyb2xsZXIge1xuICAgIGNvbnN0cnVjdG9yKHBsYXllcikge1xuICAgICAgICB0aGlzLnBsYXllciA9IHBsYXllcjtcbiAgICAgICAgdGhpcy5rZXlzID0ge307XG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCAoZSkgPT4gdGhpcy5vbktleURvd24oZSkpO1xuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsIChlKSA9PiB0aGlzLm9uS2V5VXAoZSkpO1xuICAgIH1cbiAgICBvbktleURvd24oZSkge1xuICAgICAgICB0aGlzLmtleXNbZS5jb2RlXSA9IHRydWU7XG4gICAgfVxuICAgIG9uS2V5VXAoZSkge1xuICAgICAgICB0aGlzLmtleXNbZS5jb2RlXSA9IGZhbHNlO1xuICAgIH1cbiAgICBrZXlJc1ByZXNzZWQoY29kZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5rZXlzW2NvZGVdIHx8IGZhbHNlO1xuICAgIH1cbiAgICB1cGRhdGUoZHQpIHtcbiAgICAgICAgaWYgKHRoaXMua2V5SXNQcmVzc2VkKCdLZXlXJykpIHtcbiAgICAgICAgICAgIHRoaXMucGxheWVyLm1vdmVGb3J3YXJkKGR0KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5rZXlJc1ByZXNzZWQoJ0tleVMnKSkge1xuICAgICAgICAgICAgdGhpcy5wbGF5ZXIubW92ZUJhY2t3YXJkKGR0KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5rZXlJc1ByZXNzZWQoJ0tleUEnKSkge1xuICAgICAgICAgICAgdGhpcy5wbGF5ZXIudHVybkxlZnQoZHQpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmtleUlzUHJlc3NlZCgnS2V5RCcpKSB7XG4gICAgICAgICAgICB0aGlzLnBsYXllci50dXJuUmlnaHQoZHQpO1xuICAgICAgICB9XG4gICAgfVxufVxuIiwiY29uc3QgY29uZmlnID0ge1xuICAgIFdJTkRPV19XSURUSDogMTAyNCxcbiAgICBXSU5ET1dfSEVJR0hUOiA3NjgsXG4gICAgVElMRV9TSVpFOiAxNixcbiAgICBGT1Y6IDAuNSxcbiAgICBWSUVXX0RJU1RBTkNFOiAxMDAsXG4gICAgV0FMTF9IRUlHSFQ6IDE2LFxuICAgIENPTFVNTl9XSURUSDogMVxufTtcbmV4cG9ydCBkZWZhdWx0IGNvbmZpZztcbiIsImltcG9ydCBjb25maWcgZnJvbSBcIi4vY29uZmlnXCI7XG5leHBvcnQgZGVmYXVsdCBjbGFzcyBNYXAge1xuICAgIGNvbnN0cnVjdG9yKGdyaWQpIHtcbiAgICAgICAgdGhpcy5ncmlkID0gZ3JpZDtcbiAgICB9XG4gICAgcmVuZGVyKHJlbmRlcmVyKSB7XG4gICAgICAgIGNvbnN0IHRpbGVTaXplID0gY29uZmlnLlRJTEVfU0laRSAvIDQ7XG4gICAgICAgIGZvciAobGV0IHkgPSAwOyB5IDwgdGhpcy5ncmlkLmxlbmd0aDsgeSsrKSB7XG4gICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IHRoaXMuZ3JpZFt5XS5sZW5ndGg7IHgrKykge1xuICAgICAgICAgICAgICAgIGNvbnN0IHRpbGUgPSB0aGlzLmdyaWRbeV1beF07XG4gICAgICAgICAgICAgICAgaWYgKHRpbGUgPT09IDcpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVuZGVyZXIuZHJhd1JlY3QoeCAqIHRpbGVTaXplLCB5ICogdGlsZVNpemUsIHRpbGVTaXplLCB0aWxlU2l6ZSwgJ3doaXRlJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHRpbGUgPT09IDIpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVuZGVyZXIuZHJhd1JlY3QoeCAqIHRpbGVTaXplLCB5ICogdGlsZVNpemUsIHRpbGVTaXplLCB0aWxlU2l6ZSwgJ2JsdWUnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0Q2VsbCh4LCB5KSB7XG4gICAgICAgIHggPSBNYXRoLmZsb29yKHgpO1xuICAgICAgICB5ID0gTWF0aC5mbG9vcih5KTtcbiAgICAgICAgaWYgKHggPCAwIHx8IHggPj0gdGhpcy5ncmlkWzBdLmxlbmd0aCB8fCB5IDwgMCB8fCB5ID49IHRoaXMuZ3JpZC5sZW5ndGgpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5ncmlkW3ldW3hdO1xuICAgIH1cbn1cbiIsImV4cG9ydCBjbGFzcyBWZWN0b3IyIHtcbiAgICBjb25zdHJ1Y3Rvcih4LCB5KSB7XG4gICAgICAgIHRoaXMuX3ggPSB4O1xuICAgICAgICB0aGlzLl95ID0geTtcbiAgICB9XG4gICAgZ2V0IHgoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl94O1xuICAgIH1cbiAgICBnZXQgeSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3k7XG4gICAgfVxuICAgIHNldCB4KHgpIHtcbiAgICAgICAgdGhpcy5feCA9IHg7XG4gICAgfVxuICAgIHNldCB5KHkpIHtcbiAgICAgICAgdGhpcy5feSA9IHk7XG4gICAgfVxufVxuIiwiaW1wb3J0IGNvbmZpZyBmcm9tIFwiLi9jb25maWdcIjtcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBsYXllciB7XG4gICAgY29uc3RydWN0b3IocG9zaXRpb24sIGFuZ2xlLCBzcGVlZCwgZm92KSB7XG4gICAgICAgIHRoaXMucG9zaXRpb24gPSBwb3NpdGlvbjtcbiAgICAgICAgdGhpcy5hbmdsZSA9IGFuZ2xlO1xuICAgICAgICB0aGlzLnNwZWVkID0gc3BlZWQ7XG4gICAgICAgIHRoaXMuZm92ID0gZm92O1xuICAgIH1cbiAgICB1cGRhdGUoZHQpIHtcbiAgICB9XG4gICAgcmVuZGVyKHJlbmRlcmVyKSB7XG4gICAgICAgIGNvbnN0IHNpemUgPSBjb25maWcuVElMRV9TSVpFIC8gNDtcbiAgICAgICAgcmVuZGVyZXIuZHJhd1JlY3QodGhpcy5wb3NpdGlvbi54ICogc2l6ZSwgdGhpcy5wb3NpdGlvbi55ICogc2l6ZSwgc2l6ZSwgc2l6ZSwgJ3JlZCcpO1xuICAgIH1cbiAgICBjaGFuZ2VTcGVlZChzcGVlZCkge1xuICAgICAgICB0aGlzLnNwZWVkID0gc3BlZWQ7XG4gICAgfVxuICAgIG1vdmVGb3J3YXJkKGR0KSB7XG4gICAgICAgIHRoaXMucG9zaXRpb24ueCArPSBNYXRoLmNvcyh0aGlzLmFuZ2xlKSAqIHRoaXMuc3BlZWQgKiBkdDtcbiAgICAgICAgdGhpcy5wb3NpdGlvbi55ICs9IE1hdGguc2luKHRoaXMuYW5nbGUpICogdGhpcy5zcGVlZCAqIGR0O1xuICAgIH1cbiAgICBtb3ZlQmFja3dhcmQoZHQpIHtcbiAgICAgICAgdGhpcy5wb3NpdGlvbi54IC09IE1hdGguY29zKHRoaXMuYW5nbGUpICogdGhpcy5zcGVlZCAqIGR0O1xuICAgICAgICB0aGlzLnBvc2l0aW9uLnkgLT0gTWF0aC5zaW4odGhpcy5hbmdsZSkgKiB0aGlzLnNwZWVkICogZHQ7XG4gICAgfVxuICAgIHR1cm5MZWZ0KGR0KSB7XG4gICAgICAgIHRoaXMuYW5nbGUgLT0gdGhpcy5zcGVlZCAvIDUgKiBkdDtcbiAgICB9XG4gICAgdHVyblJpZ2h0KGR0KSB7XG4gICAgICAgIHRoaXMuYW5nbGUgKz0gdGhpcy5zcGVlZCAvIDUgKiBkdDtcbiAgICB9XG59XG4iLCJpbXBvcnQgY29uZmlnIGZyb20gXCIuL2NvbmZpZ1wiO1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUmVuZGVyZXIge1xuICAgIGNvbnN0cnVjdG9yKGNhbnZhcywgd2lkdGgsIGhlaWdodCwgbWFwLCBhc3NldHMpIHtcbiAgICAgICAgdGhpcy5jYW52YXMgPSBjYW52YXM7XG4gICAgICAgIHRoaXMuY2FudmFzLndpZHRoID0gd2lkdGg7XG4gICAgICAgIHRoaXMuY2FudmFzLmhlaWdodCA9IGhlaWdodDtcbiAgICAgICAgdGhpcy5jYW52YXMuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gJ2dyYXknO1xuICAgICAgICB0aGlzLmN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xuICAgICAgICB0aGlzLm1hcCA9IG1hcDtcbiAgICAgICAgdGhpcy5hc3NldHMgPSBhc3NldHM7XG4gICAgfVxuICAgIGNsZWFyKCkge1xuICAgICAgICB0aGlzLmN0eC5jbGVhclJlY3QoMCwgMCwgdGhpcy5jYW52YXMud2lkdGgsIHRoaXMuY2FudmFzLmhlaWdodCk7XG4gICAgfVxuICAgIGRyYXdSZWN0KHgsIHksIHdpZHRoLCBoZWlnaHQsIGNvbG9yKSB7XG4gICAgICAgIHRoaXMuY3R4LmZpbGxTdHlsZSA9IGNvbG9yO1xuICAgICAgICB0aGlzLmN0eC5maWxsUmVjdCh4LCB5LCB3aWR0aCwgaGVpZ2h0KTtcbiAgICB9XG4gICAgY2FzdFJheSh4LCB5LCBhbmdsZSkge1xuICAgICAgICBsZXQgcmF5WCA9IHg7XG4gICAgICAgIGxldCByYXlZID0geTtcbiAgICAgICAgbGV0IHJheUFuZ2xlID0gYW5nbGU7XG4gICAgICAgIGxldCByYXlEaXN0YW5jZSA9IDA7XG4gICAgICAgIGxldCBtYXBDZWxsID0gbnVsbDtcbiAgICAgICAgY29uc3QgbWF4RGlzdGFuY2UgPSBjb25maWcuVklFV19ESVNUQU5DRTtcbiAgICAgICAgbGV0IHhPZmZzZXQgPSAwO1xuICAgICAgICBsZXQgeU9mZnNldCA9IDA7XG4gICAgICAgIHdoaWxlIChyYXlEaXN0YW5jZSA8IG1heERpc3RhbmNlKSB7XG4gICAgICAgICAgICByYXlYID0geCArIHJheURpc3RhbmNlICogTWF0aC5jb3MocmF5QW5nbGUpO1xuICAgICAgICAgICAgcmF5WSA9IHkgKyByYXlEaXN0YW5jZSAqIE1hdGguc2luKHJheUFuZ2xlKTtcbiAgICAgICAgICAgIG1hcENlbGwgPSB0aGlzLm1hcC5nZXRDZWxsKE1hdGguZmxvb3IocmF5WCksIE1hdGguZmxvb3IocmF5WSkpO1xuICAgICAgICAgICAgaWYgKG1hcENlbGwgIT09IDApIHtcbiAgICAgICAgICAgICAgICB4T2Zmc2V0ID0gcmF5WCAlIDE7XG4gICAgICAgICAgICAgICAgeU9mZnNldCA9IHJheVkgJSAxO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmF5RGlzdGFuY2UgKz0gMC4wMTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCByYXkgPSB7XG4gICAgICAgICAgICBkaXN0YW5jZTogcmF5RGlzdGFuY2UsXG4gICAgICAgICAgICBvYmplY3Q6IG1hcENlbGwsXG4gICAgICAgICAgICB4T2Zmc2V0LFxuICAgICAgICAgICAgeU9mZnNldCxcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIHJheTtcbiAgICB9XG4gICAgcmVuZGVyKHBsYXllcikge1xuICAgICAgICBjb25zdCBzY3JlZW5XaWR0aCA9IHRoaXMuY2FudmFzLndpZHRoO1xuICAgICAgICBjb25zdCBwbGF5ZXJYID0gcGxheWVyLnBvc2l0aW9uLng7XG4gICAgICAgIGNvbnN0IHBsYXllclkgPSBwbGF5ZXIucG9zaXRpb24ueTtcbiAgICAgICAgY29uc3QgcGxheWVyQW5nbGUgPSBwbGF5ZXIuYW5nbGU7XG4gICAgICAgIHRoaXMuY2xlYXIoKTtcbiAgICAgICAgZm9yIChsZXQgY29sdW1uID0gMDsgY29sdW1uIDwgc2NyZWVuV2lkdGg7IGNvbHVtbiArPSBjb25maWcuQ09MVU1OX1dJRFRIKSB7XG4gICAgICAgICAgICBjb25zdCByYXlBbmdsZSA9IChwbGF5ZXJBbmdsZSAtIGNvbmZpZy5GT1YgLyAyKSArIChjb2x1bW4gLyBzY3JlZW5XaWR0aCkgKiBjb25maWcuRk9WO1xuICAgICAgICAgICAgY29uc3QgcmF5ID0gdGhpcy5jYXN0UmF5KHBsYXllclgsIHBsYXllclksIHJheUFuZ2xlKTtcbiAgICAgICAgICAgIHRoaXMucmVuZGVyQ29sdW1uKGNvbHVtbiwgcmF5KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZW5kZXJDb2x1bW4oY29sdW1uLCByYXkpIHtcbiAgICAgICAgY29uc3Qgc2NyZWVuSGVpZ2h0ID0gdGhpcy5jYW52YXMuaGVpZ2h0O1xuICAgICAgICBjb25zdCB0ZXh0dXJlU2l6ZSA9IDE2O1xuICAgICAgICBjb25zdCByYXlEaXN0YW5jZSA9IHJheS5kaXN0YW5jZTtcbiAgICAgICAgY29uc3QgeE9mZnNldCA9IHJheS54T2Zmc2V0O1xuICAgICAgICBjb25zdCB5T2Zmc2V0ID0gcmF5LnlPZmZzZXQ7XG4gICAgICAgIGNvbnN0IHdhbGxIZWlnaHQgPSAoY29uZmlnLlRJTEVfU0laRSAvIHJheURpc3RhbmNlKSAqIGNvbmZpZy5WSUVXX0RJU1RBTkNFO1xuICAgICAgICBjb25zdCB3YWxsVG9wID0gKHNjcmVlbkhlaWdodCAvIDIpIC0gKHdhbGxIZWlnaHQgLyAyKTtcbiAgICAgICAgY29uc3Qgd2FsbEJvdHRvbSA9IChzY3JlZW5IZWlnaHQgLyAyKSArICh3YWxsSGVpZ2h0IC8gMik7XG4gICAgICAgIGNvbnN0IGNvbHVtbldpZHRoID0gd2FsbEhlaWdodCAqIGNvbmZpZy5DT0xVTU5fV0lEVEggKiAyO1xuICAgICAgICBjb25zdCB0ZXh0dXJlUG9zaXRpb24gPSBbdGV4dHVyZVNpemUgKiByYXkub2JqZWN0LCAwXTtcbiAgICAgICAgLy8gc2t5XG4gICAgICAgIHRoaXMuZHJhd1JlY3QoY29sdW1uLCAwLCBjb2x1bW5XaWR0aCwgd2FsbFRvcCwgJ3NreWJsdWUnKTtcbiAgICAgICAgLy8gdGhpcy5kcmF3UmVjdChjb2x1bW4sIHdhbGxUb3AsIGNvbHVtbldpZHRoLCB3YWxsSGVpZ2h0LCB3YWxsQ29sb3IpO1xuICAgICAgICAvLyBncm91bmRcbiAgICAgICAgdGhpcy5kcmF3UmVjdChjb2x1bW4sIHdhbGxCb3R0b20sIGNvbHVtbldpZHRoLCBzY3JlZW5IZWlnaHQgLSB3YWxsQm90dG9tLCAnZ3JlZW4nKTtcbiAgICAgICAgLy8gdGV4dHVyZVxuICAgICAgICB0aGlzLmN0eC5kcmF3SW1hZ2UodGhpcy5hc3NldHNbJ2Fzc2V0cy90ZXh0dXJlcy5wbmcnXSwgdGV4dHVyZVBvc2l0aW9uWzBdICsgTWF0aC5mbG9vcih4T2Zmc2V0ICogdGV4dHVyZVNpemUpLCB0ZXh0dXJlUG9zaXRpb25bMV0sIGNvbHVtbldpZHRoLCB0ZXh0dXJlU2l6ZSwgY29sdW1uLCB3YWxsVG9wLCBjb2x1bW5XaWR0aCwgd2FsbEhlaWdodCk7XG4gICAgfVxufVxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgVGltZXIge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLmxhc3RUaW1lID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgICAgIHRoaXMuZGVsdGFUaW1lID0gMDtcbiAgICAgICAgdGhpcy5jYWxsYmFjayA9ICgpID0+IHsgfTtcbiAgICB9XG4gICAgc3RhcnQoY2FsbGJhY2spIHtcbiAgICAgICAgdGhpcy5jYWxsYmFjayA9IGNhbGxiYWNrO1xuICAgICAgICB0aGlzLmxhc3RUaW1lID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgICAgIHRoaXMubG9vcCgpO1xuICAgIH1cbiAgICBsb29wKCkge1xuICAgICAgICBjb25zdCBub3cgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICAgICAgdGhpcy5kZWx0YVRpbWUgPSAobm93IC0gdGhpcy5sYXN0VGltZSk7XG4gICAgICAgIHRoaXMubGFzdFRpbWUgPSBub3c7XG4gICAgICAgIHRoaXMuY2FsbGJhY2sodGhpcy5kZWx0YVRpbWUpO1xuICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4gdGhpcy5sb29wKCkpO1xuICAgIH1cbiAgICBnZXREZWx0YVRpbWUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmRlbHRhVGltZTtcbiAgICB9XG59XG4iLCJpbXBvcnQgR2FtZSBmcm9tIFwiLi9nYW1lXCI7XG5pbXBvcnQgY29uZmlnIGZyb20gXCIuL2NvbmZpZ1wiO1xuY29uc3QgZ2FtZSA9IG5ldyBHYW1lKGNvbmZpZyk7XG5nYW1lLnN0YXJ0KCk7XG4iLCJpbXBvcnQgQ29udHJvbGxlciBmcm9tIFwiLi9jb250cm9sbGVyXCI7XG5pbXBvcnQgTWFwIGZyb20gXCIuL21hcFwiO1xuaW1wb3J0IHsgVmVjdG9yMiB9IGZyb20gXCIuL21hdGhcIjtcbmltcG9ydCBQbGF5ZXIgZnJvbSBcIi4vcGxheWVyXCI7XG5pbXBvcnQgUmVuZGVyZXIgZnJvbSBcIi4vcmVuZGVyZXJcIjtcbmltcG9ydCBUaW1lciBmcm9tIFwiLi90aW1lclwiO1xuaW1wb3J0IHsgbG9hZEFzc2V0cyB9IGZyb20gXCIuL3V0aWxzXCI7XG5leHBvcnQgZGVmYXVsdCBjbGFzcyBHYW1lIHtcbiAgICBjb25zdHJ1Y3Rvcihjb25maWcpIHtcbiAgICAgICAgdGhpcy5tYXAgPSBuZXcgTWFwKFtcbiAgICAgICAgICAgIFs3LCA3LCA3LCA3LCA3LCA3LCA3LCA3LCA3LCA3LCA3LCA3LCA3LCA3LCA3LCA3LCA3LCA3XSxcbiAgICAgICAgICAgIFs3LCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCA3LCAwLCA3LCAyLCA3XSxcbiAgICAgICAgICAgIFs3LCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAyLCA3LCAwLCA3XSxcbiAgICAgICAgICAgIFs3LCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCA3LCAyLCA3LCAwLCA3XSxcbiAgICAgICAgICAgIFs3LCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCA3LCAyLCA3LCAwLCA3XSxcbiAgICAgICAgICAgIFs3LCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCA3LCAyLCA3LCAwLCA3XSxcbiAgICAgICAgICAgIFs3LCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCA3LCAyLCA3LCAwLCA3XSxcbiAgICAgICAgICAgIFs3LCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCA3LCAyLCA3LCAwLCA3XSxcbiAgICAgICAgICAgIFs3LCA3LCA3LCA3LCA3LCA3LCA3LCA3LCA3LCA3LCA3LCA3LCA3LCA3LCAyLCA3LCAwLCA3XSxcbiAgICAgICAgICAgIFs3LCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCA3LCAyLCA3LCAwLCA3XSxcbiAgICAgICAgICAgIFs3LCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCA3LCA3LCA3LCAyLCA3LCAwLCA3XSxcbiAgICAgICAgICAgIFs3LCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCA3LCAyLCA3LCAyLCA3LCAwLCA3XSxcbiAgICAgICAgICAgIFs3LCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCA3LCAyLCA3LCAyLCA3LCAwLCA3XSxcbiAgICAgICAgICAgIFs3LCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCA3LCAyLCA3LCAyLCA3LCAwLCA3XSxcbiAgICAgICAgICAgIFs3LCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCA3LCAyLCA3LCAyLCA3LCAwLCA3XSxcbiAgICAgICAgICAgIFs3LCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCA3LCA3LCAyLCA3LCAyLCA3LCAwLCA3XSxcbiAgICAgICAgICAgIFs3LCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCA3LCAyLCAyLCA3LCAyLCA3LCAwLCA3XSxcbiAgICAgICAgICAgIFs3LCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCA3LCAyLCAyLCA3LCAyLCA3LCAwLCA3XSxcbiAgICAgICAgICAgIFs3LCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCA3LCAyLCAyLCA3LCAyLCA3LCAwLCA3XSxcbiAgICAgICAgICAgIFs3LCA3LCA3LCA3LCA3LCA3LCA3LCA3LCA3LCA3LCA3LCAyLCAyLCA3LCAyLCA3LCAwLCA3XSxcbiAgICAgICAgICAgIFs3LCAyLCAyLCAyLCAyLCAyLCAyLCAyLCAyLCAyLCA3LCAyLCAyLCA3LCAyLCA3LCAwLCA3XSxcbiAgICAgICAgICAgIFs3LCAyLCAyLCAyLCAyLCAyLCAyLCAyLCAyLCAyLCA3LCAyLCAyLCA3LCAyLCA3LCAwLCA3XSxcbiAgICAgICAgICAgIFs3LCAyLCAyLCAyLCAyLCAyLCAyLCAyLCAyLCAyLCA3LCAyLCAyLCA3LCAyLCA3LCAwLCA3XSxcbiAgICAgICAgICAgIFs3LCAyLCAyLCAyLCAyLCAyLCAyLCAyLCAyLCAyLCA3LCAyLCAyLCA3LCAyLCA3LCAwLCA3XSxcbiAgICAgICAgXSk7XG4gICAgICAgIHRoaXMuYXNzZXRzID0gbG9hZEFzc2V0cyhbJ2Fzc2V0cy90ZXh0dXJlcy5wbmcnXSk7XG4gICAgICAgIHRoaXMudGltZXIgPSBuZXcgVGltZXIoKTtcbiAgICAgICAgdGhpcy5yZW5kZXJlciA9IG5ldyBSZW5kZXJlcihkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdjYW52YXMnKSwgY29uZmlnLldJTkRPV19XSURUSCwgY29uZmlnLldJTkRPV19IRUlHSFQsIHRoaXMubWFwLCB0aGlzLmFzc2V0cyk7XG4gICAgICAgIHRoaXMucGxheWVyID0gbmV3IFBsYXllcihuZXcgVmVjdG9yMigyLCAyKSwgMCwgMC4wMDUsIGNvbmZpZy5GT1YpO1xuICAgICAgICB0aGlzLmNvbnRyb2xsZXIgPSBuZXcgQ29udHJvbGxlcih0aGlzLnBsYXllcik7XG4gICAgfVxuICAgIHVwZGF0ZShkdCkge1xuICAgICAgICB0aGlzLmNvbnRyb2xsZXIudXBkYXRlKGR0KTtcbiAgICAgICAgdGhpcy5wbGF5ZXIudXBkYXRlKGR0KTtcbiAgICB9XG4gICAgcmVuZGVyKCkge1xuICAgICAgICB0aGlzLnJlbmRlcmVyLmNsZWFyKCk7XG4gICAgICAgIHRoaXMucmVuZGVyZXIucmVuZGVyKHRoaXMucGxheWVyKTtcbiAgICAgICAgdGhpcy5tYXAucmVuZGVyKHRoaXMucmVuZGVyZXIpO1xuICAgICAgICB0aGlzLnBsYXllci5yZW5kZXIodGhpcy5yZW5kZXJlcik7XG4gICAgfVxuICAgIGxvb3AoZHQpIHtcbiAgICAgICAgdGhpcy51cGRhdGUoZHQpO1xuICAgICAgICB0aGlzLnJlbmRlcigpO1xuICAgIH1cbiAgICBzdGFydCgpIHtcbiAgICAgICAgdGhpcy50aW1lci5zdGFydCgoZHQpID0+IHRoaXMubG9vcChkdCkpO1xuICAgIH1cbn1cbiIsImV4cG9ydCBmdW5jdGlvbiBsb2FkQXNzZXRzKHNyYykge1xuICAgIGNvbnN0IGFzc2V0cyA9IHt9O1xuICAgIHNyYy5mb3JFYWNoKChwYXRoKSA9PiB7XG4gICAgICAgIGNvbnN0IGltZyA9IG5ldyBJbWFnZSgpO1xuICAgICAgICBpbWcuc3JjID0gcGF0aDtcbiAgICAgICAgYXNzZXRzW3BhdGhdID0gaW1nO1xuICAgIH0pO1xuICAgIHJldHVybiBhc3NldHM7XG59XG4iXSwibmFtZXMiOlsiQ29udHJvbGxlciIsImNvbnN0cnVjdG9yIiwicGxheWVyIiwidGhpcyIsImtleXMiLCJkb2N1bWVudCIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwib25LZXlEb3duIiwib25LZXlVcCIsImNvZGUiLCJrZXlJc1ByZXNzZWQiLCJ1cGRhdGUiLCJkdCIsIm1vdmVGb3J3YXJkIiwibW92ZUJhY2t3YXJkIiwidHVybkxlZnQiLCJ0dXJuUmlnaHQiLCJXSU5ET1dfV0lEVEgiLCJXSU5ET1dfSEVJR0hUIiwiVElMRV9TSVpFIiwiRk9WIiwiVklFV19ESVNUQU5DRSIsIldBTExfSEVJR0hUIiwiQ09MVU1OX1dJRFRIIiwiTWFwIiwiZ3JpZCIsInJlbmRlciIsInJlbmRlcmVyIiwidGlsZVNpemUiLCJ5IiwibGVuZ3RoIiwieCIsInRpbGUiLCJkcmF3UmVjdCIsImdldENlbGwiLCJNYXRoIiwiZmxvb3IiLCJWZWN0b3IyIiwiX3giLCJfeSIsIlBsYXllciIsInBvc2l0aW9uIiwiYW5nbGUiLCJzcGVlZCIsImZvdiIsInNpemUiLCJjaGFuZ2VTcGVlZCIsImNvcyIsInNpbiIsIlJlbmRlcmVyIiwiY2FudmFzIiwid2lkdGgiLCJoZWlnaHQiLCJtYXAiLCJhc3NldHMiLCJzdHlsZSIsImJhY2tncm91bmRDb2xvciIsImN0eCIsImdldENvbnRleHQiLCJjbGVhciIsImNsZWFyUmVjdCIsImNvbG9yIiwiZmlsbFN0eWxlIiwiZmlsbFJlY3QiLCJjYXN0UmF5IiwicmF5WCIsInJheVkiLCJyYXlBbmdsZSIsInJheURpc3RhbmNlIiwibWFwQ2VsbCIsIm1heERpc3RhbmNlIiwieE9mZnNldCIsInlPZmZzZXQiLCJkaXN0YW5jZSIsIm9iamVjdCIsInNjcmVlbldpZHRoIiwicGxheWVyWCIsInBsYXllclkiLCJwbGF5ZXJBbmdsZSIsImNvbHVtbiIsInJheSIsInJlbmRlckNvbHVtbiIsInNjcmVlbkhlaWdodCIsIndhbGxIZWlnaHQiLCJ3YWxsVG9wIiwid2FsbEJvdHRvbSIsImNvbHVtbldpZHRoIiwidGV4dHVyZVBvc2l0aW9uIiwiZHJhd0ltYWdlIiwiVGltZXIiLCJsYXN0VGltZSIsInBlcmZvcm1hbmNlIiwibm93IiwiZGVsdGFUaW1lIiwiY2FsbGJhY2siLCJzdGFydCIsImxvb3AiLCJyZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJnZXREZWx0YVRpbWUiLCJnYW1lIiwiY29uZmlnIiwic3JjIiwiZm9yRWFjaCIsInBhdGgiLCJpbWciLCJJbWFnZSIsImxvYWRBc3NldHMiLCJ0aW1lciIsInF1ZXJ5U2VsZWN0b3IiLCJjb250cm9sbGVyIl0sInNvdXJjZVJvb3QiOiIifQ==